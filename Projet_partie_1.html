<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="utf-8" />
        <title>Contrôler le déplacement ou non de la sorcière avec les touches du clavier</title>

        <style>
            canvas {
                border: 1px solid black;
                cursor: pointer;
            }
        </style>
        <script type="text/javascript" src="js/fonctions.js"></script>
        <script type="text/javascript" src="js/objets.js"></script>
    </head>

    <body>
        <!-- Créer la balise canvas et modifier ensuite ses dimensions -->
        <canvas width="960" height="600"></canvas>
        <script>
            //Récupérer la balise canvas et définir son contexte de dessin en 2d
            let leCanvas = document.querySelector("canvas");
            let ctx = leCanvas.getContext("2d");
            
            leCanvas.style.backgroundImage =  "url('images/debut.png')";

            //charger l'image de l'avion directement ou lavion est place dans l'image de depart
            avion.img.src = avion.urlImage;
            avion.y = leCanvas.height/2 - avion.hauteur/2 + 20;
            avion.x = leCanvas.width/2 - avion.largeur/2 - 57;

            //charger l'image du ciel
            ciel.img.src = ciel.urlImage;

            //charger l'image des oiseaux
            oiseau.img.src = oiseau.urlImage;

            //Les intervalles du jeu
            let intervalID;
            let intervalTimerID;
            //Les addEventListener
            //pour savoir quand le joueur enfonce et relache les touches de mouvements
            document.addEventListener("keyup", relacherTouche);
            document.addEventListener("keydown",presserTouche);
            //pour commencer le jeu
            document.addEventListener("click",debuterJeu,{once:true})

            function debuterJeu(){
            //On part le délpacement possible de la sorcière au démarrage selon la cadence 60 ips
            intervalID = setInterval(actualiserJeu, 1000 / 60);
            intervalTimerID = setInterval(leTimer,1000);
            }
            //L'interval pour le timer
            
            function actualiserJeu() {
                //Effacer le contenu actuel du contexte de rendu du canvas
                ctx.clearRect(0, 0, leCanvas.width, leCanvas.height);

                //deplacer le ciel
                deplacerCiel();

                //Déplacer l'avion  
                deplacerAvion();

                //Deplacer les oiseauxc
                deplacerOiseau();

                dessinerLeTimer();
            }
            
            function leTimer() {
                console.log(timer);
                
                //diminuer le timer de 1 seconde si le compteur n'est pas a 0
                if (!timerFini){
                    timer -= 1;
                }
                
                // si les secondes sont a 0 mais les minutes ne le sont pas remetre les secondes a 59 et diminuer les minute de 1
                if(timer < 0 && minute != 0 && timer !=0){
                    timer = 59;
                    minute -= 1;
                }
                
                // si le compteur est a 0 ne pas le diminuer
                else if(minute <= 0 && timer <= 0){
                    timerFini = true
                    //fin du jeu
                }
            }
            
            
        </script>
    </body>
</html>
